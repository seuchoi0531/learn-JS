<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo List App</title>
    <style>
      .doneTodo {
        text-decoration: line-through;
      }
    </style>
  </head>
  <body>
    <div id="todo">
      <header>
        <h1>Todo List - 목록 조회 🙂</h1>
      </header>
      <div id="main">
        <div id="container">
          <ul>
            <li>
              <h2>쇼핑 목록</h2>
              <!-- 새로운 할일 입력 폼 -->
              <div class="todoinput">
                <input type="text" autofocus onkeyup="handleKeyup(event)" />
                <button type="button" onclick="handleAdd()">추가</button>
              </div>
              <!-- 할일 목록이 표시되는 영역 -->
              <ul class="todolist">
                <!-- <li data-no="1">
                  <span>1</span>
                  <span><s>샘플1</s></span>
                  <button type="button">삭제</button>
                </li>
                <li data-no="2">
                  <span>2</span>
                  <span><s>샘플2</s></span>
                  <button type="button">삭제</button>
                </li>
                <li data-no="3">
                  <span>3</span>
                  <span>샘플3</span>
                  <button type="button">삭제</button>
                </li> -->
              </ul>
            </li>
          </ul>
        </div>
      </div>
      <footer>
        <p>멋쟁이 사자처럼 FrontEnd BootCamp</p>
      </footer>
    </div>

    <script>
      /**
       * Todo 아이템 하나를 표현하는 DOM 요소를 생성하는 함수
       * @param {Object} item - Todo 아이템 객체 {no: number, title: string, done: boolean}
       * @returns {HTMLElement} 생성된 Todo 아이템의 DOM 요소
       */
      function getTodoItemElem(item) {
        // item -> { no: 3, title: '라면', done: true } // Todo 객체
        /* DOM 객체
      return <li>
        <span>3</span>
        <span>샘플3</span>
        <button type="button">삭제</button>
      </li>
      */

        // <li>
        const liElem = document.createElement("li");
        // <span>
        const noElem = document.createElement("span");
        // <span>
        const titleElem = document.createElement("span");
        // <button>
        const deleteElem = document.createElement("button");

        // 3
        const noTxt = document.createTextNode(item.no);
        // 샘플3
        const titleTxt = document.createTextNode(item.title);
        // 삭제
        const deleteTxt = document.createTextNode("삭제");

        // <span>3</span>
        noElem.appendChild(noTxt);
        // <span>샘플3</span>
        titleElem.appendChild(titleTxt);
        // <button type="button">삭제</button>
        deleteElem.setAttribute("type", "button");
        titleElem.setAttribute("tabindex", 0); // 완료/미완료 처리를 위한 탭 포커싱 ***** 접근성
        deleteElem.appendChild(deleteTxt);

        // <li><span>3</span></li>
        liElem.appendChild(noElem);
        // <li><span>3</span><span>샘플3</span></li>
        liElem.appendChild(titleElem);
        // <li><span>3</span><span>샘플3</span><button type="button">삭제</button></li>
        liElem.appendChild(deleteElem);

        // custom 속성
        // <li data-no="3" data-done="false">
        // elem.dataset.no -> 3, elem.dataset.done -> false
        liElem.dataset.no = item.no;
        liElem.dataset.done = item.done;

        // "삭제" 버튼에 클릭 이벤트 핸들러 추가
        deleteElem.addEventListener("click", function (event) {
          // no를 찾아서~~~ 첫번째 방법
          // const btn = event.target; // 클릭 이벤트가 발생한 요소(<button>)
          // // btn의 조상중 셀렉터와 일치하는 가장 가까운 조상
          // const liNode = btn.closest('li'); // <li data-no="3">
          // deleteItem(liNode.dataset.no);
          // no를 찾아서~~~ 두번째 방법
          // TODO 클로저 단원에서 이상한 부분 확인
          // deleteItem(item.no);
        });

        // 삭제 이벤트 등록
        deleteElem.setAttribute("onclick", `deleteItem(${item.no})`);

        // 완료/미완료 처리
        titleElem.setAttribute("onclick", `toggleDone(${item.no})`);
        // <li>
        //   <span>3</span>
        //   <span>샘플3</span>
        //   <button type="button">삭제</button>
        // </li>
        return liElem;
      }

      /**
       * 추가 버튼 클릭 시 실행되는 이벤트 핸들러
       * 입력창의 값을 가져와 새로운 Todo 아이템을 추가
       */
      function handleAdd() {
        const inputElem = document.querySelector(".todoinput > input");
        if (inputElem.value.trim() !== "") {
          addItem(inputElem.value.trim()); // <input>, <select> 같은 폼의 입력 요소에는 value 속성으로 사용자가 입력/선택한 값이 저장되어 있음
          inputElem.value = "";
          inputElem.focus();
        }
      }

      /**
       * 입력창에서 키보드 입력 시 실행되는 이벤트 핸들러
       * Enter 키 입력 시 추가 기능 실행
       * @param {KeyboardEvent} event - 키보드 이벤트 객체
       */
      function handleKeyup(event) {
        if (event.key === "Enter") handleAdd();
      }

      /**
       * 새로운 Todo 아이템을 목록에 추가하는 함수
       * @param {string} title - 추가할 Todo 아이템의 제목
       */
      function addItem(title) {
        const todoList = document.querySelector(".todolist");

        const item = {
          // children: 자식노드의 목록(요소노드)
          no: todoList.children.length + 1,
          // no: document.querySelectorAll('.todolist > li').length + 1,
          // no: ++itemNo,
          // title: title, // 속성값을 담는 변수가 속성명과 일치할 경우 속성값 생략 가능
          title,
          done: false, // 미완료 상태
        };
        const todoLi = getTodoItemElem(item);
        console.log(todoLi);

        todoList.appendChild(todoLi);
      }

      /**
       * Todo 아이템의 완료/미완료 상태를 토글하는 함수
       * @param {number} no - 토글할 Todo 아이템의 번호
       */
      // createElement를 사용한 방법
      function toggleDone1(no) {
        // 1. 매개변수로 주어진 no와, data-no의 값이 같은 li를 가져옴
        const targetLi = document.querySelector(`.todolist > li[data-no="${no}"]`);

        // 2. li의 data-done가 "false"면 if, "true"면 else
        if (targetLi.dataset.done === "false") {
          // 3. li의 두번째 요소 노드(title 있는 span)의 첫번째 자식(텍스트 노드)
          const titleNode = targetLi.children[1].firstChild;
          // 4. title이 있는 텍스트 노드의 밸류, string 타입 / 예) "코딩공부"
          const titleTxt = titleNode.nodeValue;
          // 5. "코딩공부"를 갖는 텍스트 노드 생성
          const newTextNode = document.createTextNode(titleTxt);
          // 6. 취소선에 해당하는 s 요소 노드 생성
          const cancelElem = document.createElement("s");
          // 7. s 요소 노드를 li의 두번째 요소 노드(title 있는 span)의 마지막 자식으로 추가
          // 취소선이 그어지지 않은 텍스트가 첫 번째 자식이고, 추가한 노드는 두 번째 자식이 됨
          targetLi.children[1].appendChild(cancelElem);
          // 8. "코딩공부"를 갖는 텍스트 노드를 s 요소 노드의 마지막 자식으로 추가
          cancelElem.appendChild(newTextNode);
          // 9. li의 두번째 요소 노드의 첫 번째 자식 제거
          // 추가한 노드만 남게 됨
          targetLi.children[1].firstChild.remove();
          // 10. 취소선이 그어졌다는 건 이미 완료한 일이라는 뜻이므로, done을 true로 변경
          // 그래야 다음 번 클릭 때 else문의 코드가 실행 됨
          targetLi.dataset.done = true;
        } else {
          // 3. 위 if문에서 3, 4를 합친 것, "코딩공부" string
          // 취소선이 그어지기 전엔 li>span>"코딩공부" 관계였다면,
          // 취소선이 그어진 후엔 li>span>s>"코딩공부" 관계이기 때문에 if문과 살짝 다름
          const titleTxt = targetLi.children[1].firstChild.firstChild.nodeValue;
          // 4. "코딩공부"를 갖는 텍스트 노드 생성
          const newNode = document.createTextNode(titleTxt);
          // 5. span의 마지막 자식으로 텍스트 노드 추가
          // s 요소 노드가 첫 번째 자식이고, 추가한 노드는 두번째 자식이 됨
          targetLi.children[1].appendChild(newNode);
          // 6. span의 첫 번째 자식 제거
          // 추가한 노드만 남게 됨
          targetLi.children[1].firstChild.remove();
          // 7. 취소선이 제거됐다는 건 해야할 일이라는 뜻이므로, done을 false로 변경
          // 그래야 다음 번 클릭 때 if문의 코드가 실행 됨
          targetLi.dataset.done = false;
        }
      }

      // innerHTML을 사용한 방법
      function toggleDone3(no) {
        // 1. 매개변수로 주어진 no와, data-no의 값이 같은 li를 가져옴
        const targetLi = document.querySelector(`.todolist > li[data-no="${no}"]`);
        // 2. 두 번째 span
        // "코딩공부"가 들어간 span
        const secondSpan = targetLi.children[1];
        // 3. "코딩공부"가 들어간 span의 innerText, 즉 "코딩공부"
        // span>"코딩공부" 관계일 때 innerText에 해당
        // span>s>"코딩공부"의 관계라고 해도 innerText는 태그를 신경쓰지 않기 때문에,
        // "코딩공부"만 선택됨
        const titleTxt = secondSpan.innerText;
        // 4. li의 data-done가 "false"면 if, "true"면 else
        if (targetLi.dataset.done == "false") {
          // 5. 두 번째 span의 innerHTML을 아래처럼 변경
          // 태그를 넣을거기 때문에 innerText가 아닌 innerHTML
          secondSpan.innerHTML = `<s>${titleTxt}</s>`;
          // 6. 취소선이 그어졌다는 건 이미 완료한 일이라는 뜻이므로, done을 true로 변경
          // 그래야 다음 번 클릭 때 else문의 코드가 실행 됨
          targetLi.dataset.done = true;
        } else {
          // 5. 두 번째 span의 innerHTML을 아래처럼 변경
          // secondSpan.innerHTML은 "<s>코딩공부</s>"이므로,
          // 아래처럼 대입하면 "코딩공부"가 대입 됨
          // 즉, s태그가 없어진 것처럼 보임
          secondSpan.innerHTML = titleTxt;
          // 6. 취소선이 제거됐다는 건 해야할 일이라는 뜻이므로, done을 false로 변경
          // 그래야 다음 번 클릭 때 if문의 코드가 실행 됨
          targetLi.dataset.done = false;
        }
      }

      // 클래스를 추가하는 방법
      // 미리 추가할 클래스에 css작업을 해야 함
      // 보이는 것만 취소로 보이기 때문에,
      // 브라우저, 검색엔진, 스크린리더 등은 취소된지 모름(s태그가 아니라서)
      // 의자 가는 방법
      function toggleDone2(no) {
        // 1. 매개변수로 주어진 no와, data-no의 값이 같은 li를 가져옴
        const targetLi = document.querySelector(`.todolist > li[data-no="${no}"]`);
        // 2. 두 번째 span
        // "코딩공부"가 들어간 span
        const secondSpan = targetLi.children[1];
        // 3. li의 data-done가 "false"면 if, "true"면 else
        if (targetLi.dataset.done == "false") {
          // 4. doneTodo 클래스를 secondSpan의 classList에 추가
          // css작업을 해 둬서 취소선 스타일(text-decoration: line-through)가 적용 됨
          secondSpan.classList.add("doneTodo");
          // 5. 취소선이 그어졌다는 건 이미 완료한 일이라는 뜻이므로, done을 true로 변경
          // 그래야 다음 번 클릭 때 else문의 코드가 실행 됨
          targetLi.dataset.done = true;
        } else {
          // 4. doneTodo 클래스를 secondSpan의 classList에서 제거
          // 취소선 스타일(text-decoration: line-through)이 적용된 클래스가 제거됨
          // 즉, 취소선이 사라짐
          secondSpan.classList.remove("doneTodo");
          // 5. 취소선이 제거됐다는 건 해야할 일이라는 뜻이므로, done을 false로 변경
          // 그래야 다음 번 클릭 때 if문의 코드가 실행 됨
          targetLi.dataset.done = false;
        }
      }
      /**
       * Todo 아이템을 삭제하는 함수
       * @param {number} no - 삭제할 Todo 아이템의 번호
       */
      function deleteItem(no) {
        const targetLi = document.querySelector(`.todolist > li[data-no="${no}"]`);
        targetLi.remove();
      }
    </script>
  </body>
</html>
